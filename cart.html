<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Cart - Anis Boutique</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css" />

  <style>
  .cart-title {
  max-width: 300px;
  margin: 30px auto 0px;   /* ‚¨Ö reduce top gap */
  padding: 30px 0px;
  font-size: 22px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #111;
  text-align: center;        /* ‚¨Ö align like cart items */
}


    body {
      background: #f7f7f7;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0px;
      padding: 0;
      margin-top: -30px;
      padding-bottom: 80px;
    }

    .cart-container {
      max-width: 900px;
      margin: 0px auto 40px;
      padding: 20px;
    }

    .cart-item {
      display: flex;
      align-items: center;
      gap: 20px;
      background: #fff;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .cart-item img {
      width: 90px;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
    }

    .cart-details {
      flex-grow: 1;
    }

    .cart-details h3 {
      margin: 0 0 6px;
      font-size: 16px;
      font-weight: 600;
      color: #111;
    }

    .cart-details p {
      margin: 0 0 10px;
      font-size: 14px;
      color: #555;
    }
.available-coupons {
  max-width: 900px;
  margin: 20px auto 10px;
  padding: 0 20px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}

.coupon-chip {
  padding: 8px 14px;
  border: 1px dashed purple;
  border-radius: 999px;
  font-size: 13px;
  letter-spacing: 1px;
  cursor: pointer;
  background: #fff;
  transition: all 0.25s ease;
}

.coupon-chip:hover {
  background: purple;
  color: #fff;
}

    .remove-btn {
      padding: 6px 14px;
      background: transparent;
      border: 1px solid #111;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.25s ease;
    }

    .remove-btn:hover {
      background: purple;
      color: #fff;
    }

    .coupon-box {
      max-width: 900px;
      margin: 30px auto 10px;
      display: flex;
      gap: 10px;
      padding: 0 20px;
    }

    .coupon-box input {
      flex: 1;
      padding: 14px;
      border: 1px solid #000;
      font-size: 14px;
      outline: none;
      background: #fff;
    }

    .coupon-box button {
      padding: 14px 26px;
      background: purple;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
.coupon-title {
  text-align: center;
  margin-top: 40px;
  margin-bottom: 12px;
  font-size: 18px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #111;
}

    .coupon-box button:hover {
      background: #222;
    }

    .coupon-message {
      text-align: center;
      margin-top: 14px;
      font-size: 14px;
      font-weight: 600;
    }

    .grand-total {
      text-align: center;
      font-size: 20px;
      font-weight: 600;
      margin-top: 30px;
      letter-spacing: 1px;
    }

#checkout-btn {
  display: block;
  margin: 50px auto 0;   /* ‚ùå no bottom margin */
  padding: 16px 40px;
  background: purple;
  color: #fff;
  border: none;
  border-radius: 999px;
  font-size: 15px;
  cursor: pointer;
  margin-top: 30px;
  transition: all 0.3s ease;
}



    #checkout-btn:hover {
      background: #222;
    }

    @media (max-width: 600px) {
      .cart-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .cart-item img {
        width: 100%;
        height: auto;
      }
    }
  </style>
</head>

<body>
<div id="preloader">
  <div class="loader-text">
    <span>ANIS</span>
    <span>BOUTIQUE</span>
  </div>
</div>
<h1 class="cart-title">Your Cart</h1>

<div id="cart-container" class="cart-container"></div>
<h2 class="coupon-title">Apply Your Coupon</h2>

<!-- AVAILABLE COUPONS -->

<div class="available-coupons" id="available-coupons"></div>

<div class="coupon-box">
  <input type="text" id="coupon-input" placeholder="Enter coupon code" />
  <button id="apply-coupon-btn">Apply</button>
</div>

<div id="coupon-message" class="coupon-message"></div>

<div id="grand-total" class="grand-total"></div>

<button id="checkout-btn">Pay Now</button>

<script>
    window.addEventListener("load", () => {
    const loader = document.getElementById("preloader");

    setTimeout(() => {
      loader.style.opacity = "0";

      setTimeout(() => {
        loader.style.display = "none";
      }, 600);
    }, 1000); // üëà loader stays for 1.2s
  });
document.addEventListener('DOMContentLoaded', () => {

  const container = document.getElementById('cart-container');
  const grandTotalEl = document.getElementById('grand-total');
  const checkoutBtn = document.getElementById('checkout-btn');

  const couponInput = document.getElementById('coupon-input');
  const couponMessage = document.getElementById('coupon-message');
  const applyCouponBtn = document.getElementById('apply-coupon-btn');

  async function loadAvailableCoupons() {
  try {
    const res = await fetch(
      'https://anisboutique-backend.onrender.com/api/coupons'
    );

    const coupons = await res.json();
    const wrapper = document.getElementById('available-coupons');
    wrapper.innerHTML = '';

    if (!Array.isArray(coupons) || coupons.length === 0) return;

    const today = new Date();

    coupons.forEach(c => {
      // ‚ùå skip inactive
      if (c.is_active === 0) return;

      // ‚ùå skip expired
      if (c.expiry_date && new Date(c.expiry_date) < today) return;

      const chip = document.createElement('div');
      chip.className = 'coupon-chip';
      chip.textContent = c.coupon_code;

      // ‚úÖ AUTO APPLY on click
      chip.addEventListener('click', async () => {
        couponInput.value = c.coupon_code;
        applyCouponBtn.click(); // üî• auto apply
      });

      wrapper.appendChild(chip);
    });
  } catch (err) {
    console.error('Failed to load coupons');
  }
}


  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  let originalTotal = 0;
  let finalTotal = 0;

  function updateCartUI() {
    container.innerHTML = '';
    originalTotal = 0;

    if (cart.length === 0) {
      container.innerHTML = '<p style="text-align:center">Your cart is empty.</p>';
      grandTotalEl.textContent = '';
      checkoutBtn.style.display = 'none';
      return;
    }

    cart.forEach(product => {
      originalTotal += parseFloat(product.price);

      const item = document.createElement('div');
      item.className = 'cart-item';
      item.innerHTML = `
        <img src="${product.image_url}" />
        <div class="cart-details">
          <h3>${product.name}</h3>
          <p>‚Çπ${product.price}</p>
          <button class="remove-btn">Remove</button>
        </div>
      `;
      container.appendChild(item);
    });

    finalTotal = originalTotal;
    grandTotalEl.textContent = `Grand Total: ‚Çπ${originalTotal}`;
    checkoutBtn.style.display = 'block';
  }

  updateCartUI();
  loadAvailableCoupons();

  container.addEventListener('click', (e) => {
    if (e.target.classList.contains('remove-btn')) {
      const index = [...container.children].indexOf(
        e.target.closest('.cart-item')
      );

      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartUI();
    }
  });

  applyCouponBtn.addEventListener('click', async () => {
    const code = couponInput.value.trim();
    if (!code) return;

    try {
      const res = await fetch(
        'https://anisboutique-backend.onrender.com/api/coupons/apply',
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            coupon_code: code,
            cart_total: originalTotal
          })
        }
      );

      const data = await res.json();

      if (!res.ok) {
        couponMessage.style.color = 'red';
        couponMessage.textContent = data.error;
        return;
      }

      finalTotal = data.final_total;
      couponMessage.style.color = 'green';
      couponMessage.textContent = `Coupon Applied! You saved ‚Çπ${data.discount}`;

      grandTotalEl.textContent = `Grand Total: ‚Çπ${finalTotal}`;
    } catch (err) {
      couponMessage.style.color = 'red';
      couponMessage.textContent = 'Failed to apply coupon';
    }
  });

  checkoutBtn.addEventListener('click', () => {
    localStorage.setItem('finalAmount', finalTotal);
    window.location.href = 'checkout.html';
  });

});
</script>

</body>
</html>

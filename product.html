<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anis Boutique | Product</title>

  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    #sizeSelect {
      font-size: 14px;
      padding: 6px 10px;
      min-width: 140px;
      border-radius: 4px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
  </style>
</head>
<body>
<div id="preloader">
  <div class="loader-text">
    <span>ANIS</span>
    <span>BOUTIQUE</span>
  </div>
</div>

<!-- HEADER (matches index.html) -->
<header class="header-left">
  <div class="left">
    <i class="fas fa-bars" id="hamburger-product"></i>
  </div>

  <div class="header-center">
    <a href="index.html" class="logo">
      <img src="logo.png" alt="Anis Boutique Logo" class="logo">
    </a>
  </div>

  <div class="header-right">
    <a href="cart.html">
      <i class="fas fa-shopping-cart"></i>
    </a>
  </div>
</header>

<!-- SIDEBAR -->
<div id="sidebar-product" class="sidebar">
  <a href="index.html"><strong>HOME</strong></a>
  <a href="contact.html"><strong>CONTACT US</strong></a>
  <a href="yourOrders.html"><strong>YOUR ORDERS</strong></a>
  <a href="privacy.html"><strong>PRIVACY POLICY</strong></a>
  <hr>
  <strong>COLLECTIONS</strong>
  <div id="category-list"></div>
</div>

<!-- PRODUCT DETAIL -->
<main class="product-detail-container">
  <div class="left-column">
    <img id="product-image" class="main-product-image" alt="Product Image">
    <div id="extra-images" class="extra-images"></div>
  </div>

  <div class="right-column">
    <h1 id="product-name"></h1>
    <p id="product-price" class="product-detail-price"></p>
    <p id="product-description"></p>

    <div class="size-section">
      <label for="sizeSelect">Size:</label>
      <select id="sizeSelect" required>
        <option value="">Select Size</option>
      </select>
    </div>

    <button class="add-to-cart">Add to Cart</button>
  </div>
</main>

<script>
  window.addEventListener("load", () => {
    const loader = document.getElementById("preloader");

    setTimeout(() => {
      loader.style.opacity = "0";

      setTimeout(() => {
        loader.style.display = "none";
      }, 600);
    }, 1000); // ðŸ‘ˆ loader stays for 1.2s
  });

document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const productId = params.get('id');

  fetch(`https://anisboutique-backend.onrender.com/api/products/${productId}`)
    .then(res => res.json())
    .then(product => {

      document.getElementById('product-image').src = product.image_url;
      document.getElementById('product-name').textContent = product.name;
      document.getElementById('product-description').textContent = product.description;

      const priceEl = document.getElementById('product-price');
      if (product.discounted_price) {
        priceEl.innerHTML = `
          <span class="old-price">â‚¹${parseFloat(product.price).toLocaleString()}</span>
          <span class="new-price">â‚¹${parseFloat(product.discounted_price).toLocaleString()}</span>
        `;
      } else {
        priceEl.innerHTML = `
          <span class="new-price">â‚¹${parseFloat(product.price).toLocaleString()}</span>
        `;
      }

      const extraImagesContainer = document.getElementById('extra-images');
      if (Array.isArray(product.extra_images)) {
        product.extra_images.forEach(url => {
          const img = document.createElement('img');
          img.src = url;
          img.className = 'extra-image';
          img.onclick = () => openFullscreenImage(url);
          extraImagesContainer.appendChild(img);
        });
      }

      const sizeSelect = document.getElementById("sizeSelect");
      (product.sizes || []).forEach(size => {
        const option = document.createElement("option");
        option.value = size;
        option.textContent = size;
        sizeSelect.appendChild(option);
      });

      document.querySelector('.add-to-cart').addEventListener('click', () => {
        const selectedSize = sizeSelect.value;
        if (!selectedSize) {
          alert("Please select a size before adding to cart.");
          return;
        }

        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        const finalPrice = product.discounted_price || product.price;

        cart.push({
          id: product.id,
          name: product.name,
          price: finalPrice,
          image_url: product.image_url,
          category: product.category,
          size: selectedSize,
          quantity: 1
        });

        localStorage.setItem('cart', JSON.stringify(cart));
        window.location.href = 'cart.html';
      });
    });

  fetch("https://anisboutique-backend.onrender.com/api/products/categories")
    .then(res => res.json())
    .then(categories => {
      const categoryList = document.getElementById("category-list");
      categoryList.innerHTML = '';
      categories.forEach(cat => {
        const a = document.createElement("a");
        a.href = `category.html?cat=${encodeURIComponent(cat)}`;
        a.textContent = cat;
        categoryList.appendChild(a);
      });
    });

  const hamburger = document.getElementById('hamburger-product');
  const sidebar = document.getElementById('sidebar-product');

  hamburger.onclick = () => sidebar.classList.toggle('active');
});

function openFullscreenImage(url) {
  const overlay = document.createElement('div');
  overlay.style.cssText = `
    position:fixed; inset:0;
    background:rgba(0,0,0,.9);
    display:flex; align-items:center; justify-content:center;
    z-index:1000;
  `;
  const img = document.createElement('img');
  img.src = url;
  img.style.maxWidth = '90%';
  img.style.maxHeight = '90%';
  overlay.onclick = () => document.body.removeChild(overlay);
  overlay.appendChild(img);
  document.body.appendChild(overlay);
}
</script>

</body>
</html>
